#!/usr/bin/env bash

set -e

declare yellow="\e[33m"
declare reset="\e[0m"

echo -e "\n${yellow}Initializing your work environment...${reset}\n"

# ==================================
# Wallstreeters
# ==================================

session="wallstreeters"
workspace="$HOME/github.com/wallstreeters/client"

if tmux has-session -t $session &>/dev/null; then
  tmux kill-session -t "$session"
fi

tmux new-session -d -s "$session" -c "$workspace"

window=1
tmux rename-window -t "${session}:${window}" "neovim"
tmux send-keys -t "${session}:${window}" "nvimr-reset" C-m

window=2
tmux new-window -t "${session}:${window}" -n "server" -c "$workspace"
tmux send-keys -t "${session}:${window}" "yarn docker:start && yarn psql" C-m

tmux split-window -h -t "${session}:${window}" -c "$workspace"
tmux send-keys -t "${session}:${window}.2" "yarn dev" C-m

window=3
tmux new-window -t "${session}:${window}" -n "docker" -c "$workspace"
tmux send-keys -t "${session}:${window}" "lazydocker" C-m

tmux select-window -t :+1

# ==================================
# AoLado
# ==================================

session="aolado"
workspace="$HOME/github.com/aolado-labs/aolado"

if tmux has-session -t $session &>/dev/null; then
  tmux kill-session -t "$session"
fi

tmux new-session -d -s "$session" -c "$workspace"

window=1
tmux rename-window -t "${session}:${window}" "neovim"
tmux send-keys -t "${session}:${window}" "nvimr-reset" C-m

# ==================================
# Neon Noir
# ==================================

session="neon-noir"
workspace="$HOME/github.com/odas0r/neon-noir"

if tmux has-session -t $session &>/dev/null; then
  tmux kill-session -t "$session"
fi

tmux new-session -d -s "$session" -c "$workspace"

window=1
tmux rename-window -t "${session}:${window}" "neovim"
tmux send-keys -t "${session}:${window}" "nvimr-reset" C-m

# ==================================
# Other Configs
# ==================================

# attach to the working tmux session
# tmux attach-session -t wallstreeters
session=$(
  tmux ls |
    fzf-tmux -p 40% --multi --prompt="Your sessions > "
)
session=${session%%:*}

if [[ -z "$session" ]]; then
  echo "session cannot be empty"
  exit 1
fi

tmux attach-session -t "$session"
